<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{layout/library/libraryDefault}">
		<!-- 열람실 스크립트 -->
<th:block layout:fragment="customScript">
<style>
table.makeTbLine tbody tr td {color: black; text-align: center; font-size: 12px; width: 40px; height: 35px; border: 1px solid #000;}
</style>
	<script th:inline="javascript">
		$(document).ready(function(){
			
		
			$(document).on('click', '.fTable', function(){
				var fCode = $(this).find('input[name=fCode]').val();
				var fKinds = $(this).find('input[name=fKinds]').val();
				var fSeatOrImg = $(this).find('input[name=fSeatOrImg]').val();
				var fName = $(this).find('input[name=fName]').val();				
				var tdTable = $('#tdTable')
				var contents = '';
				
				if(fKinds == '열람실' || fKinds == '사물함'){
					console.log('열람실 / 사물함임')
					var fRow = $(this).find('input[name=fRow]').val();
					var fCol = $(this).find('input[name=fCol]').val();
					
					 /* 테이블 그려주기 */
					var seatArray = fSeatOrImg.split(',');
					 console.log(seatArray);
						contents += '<br><h3>자리 배치도&emsp;&emsp;'+fName+'</h3><br>'
						contents += '<table class="makeTbLine" border="0px;" style="display: inline-block;">';
						for(var i = 1; i <= fCol; i++){
							contents += '<tr>';
							for(var j = 1; j <= fRow; j++){
								contents += '<td class="tdClass" style="color:black; text-align: center; font-size:12px;  width: 40px; height: 35px;"'+ 
								'seat="'+i+'-'+j+'" status="true">'+i+'-'+j+'</td>';
							}
							contents += '</tr>';
						}
						contents += '</table>';
					 tdTable.html(contents)
					 var tdClass = $('.tdClass');
					 
					 /* DB에서 해당 시설코드에 대한 예약자를 문자열(배열로만들수있게)가져온다. */
					 var request = $.ajax({
						  url: "/lifrary/reservationAjax",
						  method: "POST",
						  data: { 'fCode' : fCode },
						  dataType: "json"
						});
						 
						request.done(function( data ) {
							console.log(data)
						});
						 
						request.fail(function( jqXHR, textStatus ) {
						  alert( "Request failed: " + textStatus );
						});
					 
					 
					 
					 
					 /* 뿌려준 테이블에 가져온 배열(선택된 자리)색칠해주기 */
					 for(var i = 0; i < tdClass.length; i++){
						if(seatArray.indexOf(tdClass.eq(i).attr('seat')) >= 0){ // 배열에서 tdClass의 seat값과 같은 게있는가.
						//console.log(tdClass.eq(i).attr('seat') + ' <= 배열안에 tdClass의 seat와 같은것');
						tdClass.eq(i).css("background-color",'#58FA58'); //#58FA58  = 초록      #FA5858 = 빨강
						tdClass.eq(i).text(seatArray.indexOf(tdClass.eq(i).attr('seat'))+1);
						}else{
							tdClass.eq(i).css("color",'white')					// seat값과 다르면 글자색을 흰색으로 변경
							tdClass.eq(i).text('');								// 글자 없애기
						}
					} 
				 
				} else if(fKinds == '스터디룸' || fKinds == '강연실'){
					console.log('스터디룸 / 강연실')
				}
					
			})
		})
	</script>
</th:block>		

		<th:block layout:fragment="customContents">
			<!-- Start: Page Banner -->
	        	<section th:replace="fragments/library/facilityBanner :: facilityBannerFragment"></section>
	        <!-- End: Page Banner -->
		
	       
	        <!-- Start: reading Room Section -->
	        	<section th:replace="fragments/library/facilitySection :: facilitySectionFragment"></section>
	        <!-- End: reading Room Section -->
	       
	       	       
		</th:block>
</html>