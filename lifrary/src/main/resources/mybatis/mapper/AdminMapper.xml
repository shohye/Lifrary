<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="ksmart.pentagon.user.AdminMapper">
   <resultMap type="ksmart.pentagon.vo.User" id="userResultMap">
	<!-- db -->
	<result property="uId" column="u_id"/>
	<result property="lCode" column="l_code"/>
	<result property="ulLevel" column="ul_level"/>
	<result property="uDivision" column="u_division"/>
	<result property="ulName" column="ul_name"/>
	<result property="uasCode" column="uas_code"/>
	<result property="uasName" column="uas_name"/>
	<result property="uasLendLimit" column="uas_lend_limit"/>
	<result property="uasFacilityLimit" column="uas_facility_limit"/>
	<result property="uNumber" column="u_number"/>
	<result property="uPw" column="u_pw"/>
	<result property="uName" column="u_name"/>
	<result property="uBirth" column="u_birth"/>
	<result property="uAddr" column="u_addr"/>
	<result property="uTel" column="u_tel"/>
	<result property="uEmail" column="u_email"/>
	<result property="uEmailAgree" column="u_email_agree"/>
	<result property="uAppointment" column="u_appointment"/>
	<result property="uOverdueDay" column="u_overdue_day"/>
	<result property="uDate" column="u_date"/>
	<result property="uAuthorityDate" column="u_authority_date"/>
	<collection property="librarianLevel" resultMap="librarian"/>
 </resultMap>
  <resultMap type="ksmart.pentagon.vo.LibrarianLevel" id="librarian">
	<!-- db -->
	<result property="uId" column="u_id"/>
	<result property="lCode" column="l_code"/>
	<result property="llInsert" column="ll_insert"/>
	<result property="llCarry" column="ll_carry"/>
	<result property="llBookAdmin" column="ll_book_admin"/>
	<result property="llStats" column="ll_stats"/>
	<result property="llBookStock" column="ll_book_stock"/>
	<result property="llUpdate" column="ll_update"/>
 </resultMap>
 <resultMap type="ksmart.pentagon.vo.UserLevel" id="userLevel">
	<!-- db -->
	<result property="uId" column="u_id"/>
	<result property="lCode" column="l_code"/> 
	<result property="ulLevel" column="ul_level"/>
	<result property="ulName" column="ul_name"/>
	<result property="ulMin" column="ul_min"/>
	<result property="ulMax" column="ul_max"/>
	<result property="ulLendNum" column="ul_lend_num"/>
	<result property="ulLendDay" column="ul_lend_day"/>
	<result property="ulDate" column="ul_date"/>
 </resultMap>
 <resultMap type="ksmart.pentagon.vo.UserAuthoritySet" id="userAuthoritySet">
	<!-- db -->
	<result property="uasCode" column="uas_code"/>
	<result property="lCode" column="l_code"/> 
	<result property="uId" column="u_id"/>
	<result property="uasName" column="uas_name"/>
	<result property="uasOverdueMin" column="uas_overdue_min"/>
	<result property="uasOverdueMax" column="uas_overdue_max"/>
	<result property="uasLendLimit" column="uas_lend_limit"/>
	<result property="uasFacilityLimit" column="uas_facility_limit"/>
	<result property="uasLimitDate" column="uas_limit_date"/>
	<result property="uasDate" column="uas_date"/>
 </resultMap>
  <resultMap type="ksmart.pentagon.vo.UserLevelHistory" id="userLevelHistory">
	<!-- db -->
	<result property="ulhCode" column="ulh_code"/>
	<result property="lCode" column="l_code"/>
	<result property="uId" column="u_id"/> 
	<result property="ulLevel" column="ul_level"/>
	<result property="ulName" column="ul_name"/>
	<result property="uName" column="u_name"/>
	<result property="ulhReason" column="ulh_reason"/>
	<result property="ulhDate" column="ulh_date"/>
 </resultMap>
 <resultMap type="ksmart.pentagon.vo.UserAuthorityHistory" id="userAuthorityHistory">
	<!-- db -->
	<result property="uahCode" column="uah_code"/>
	<result property="lCode" column="l_code"/>
	<result property="uId" column="u_id"/> 
	<result property="uasCode" column="uas_code"/>
	<result property="uasName" column="uas_name"/>
	<result property="uName" column="u_name"/>
	<result property="uahReason" column="uah_reason"/>
	<result property="uahDate" column="uah_date"/>
 </resultMap>
 
	<select id="adminLoginCheck" resultMap="userResultMap">
		SELECT
			u.u_id,
			u.u_pw,
			u.u_division,
			u.u_name,
			ll.ll_insert,
			ll.ll_carry,
			ll.ll_book_admin,
			ll.ll_stats,
			ll.ll_book_stock
		FROM
			user AS u INNER JOIN librarian_level AS ll
		ON
			u.u_id = ll.u_id
		WHERE
			u.u_id = #{uId}
	</select>
 
  	<select id="getUserLevel" resultType="ksmart.pentagon.vo.UserLevel">
  		SELECT 
  			ul_level as ulLevel, 
  			l_code as lCode, 
  			u_id as uId, 
  			ul_min as ulMin, 
  			ul_max as ulMax, 
  			ul_lend_num as ulLendNum, 
  			ul_lend_day as ulLendDay, 
  			ul_date as ulDate
		FROM 
			user_level
  	</select>
  	
  	<select id="getUserList" resultType="ksmart.pentagon.vo.User">
		SELECT 
			u.u_number 				AS uNumber
			,u.u_id 	 			AS uId
			,ul.ul_name				AS ulName
			,u.u_name 				AS uName
			,u.u_birth				AS uBirth
			,u.u_tel				AS uTel
			,u.u_email_agree		AS uEmailAgree
			,u.u_email				AS uEmail
			,uas.uas_lend_limit		AS uasLendLimit
			,uas.uas_facility_limit AS uasFacilityLimit
			,uas.uas_name			AS uasName
			,u.u_overdue_day		AS uOverdueDay
			,u.u_date				AS uDate
		FROM
			user as u 
		INNER JOIN 
			user_authority_set as uas
		ON 
			u.uas_code = uas.uas_code
		INNER join
			user_level AS ul
		on
			ul.ul_level = u.ul_level
  	</select>
  	
  	<select id="getUserSearch" parameterType="String" resultType="ksmart.pentagon.vo.User">
		SELECT 
			u.u_number 				AS uNumber
			,u.u_id 	 			AS uId
			,ul.ul_name				AS ulName
			,u.u_name 				AS uName
			,u.u_birth				AS uBirth
			,u.u_tel				AS uTel
			,u.u_email_agree		AS uEmailAgree
			,u.u_email				AS uEmail
			,uas.uas_lend_limit		AS uasLendLimit
			,uas.uas_facility_limit AS uasFacilityLimit
			,uas.uas_name			AS uasName
			,u.u_overdue_day		AS uOverdueDay
			,u.u_date				AS uDate
		FROM
			user as u 
		INNER JOIN 
			user_authority_set as uas
		ON 
			u.uas_code = uas.uas_code
		INNER join
			user_level AS ul
		on
			ul.ul_level = u.ul_level
		<trim prefix="where" prefixOverrides="AND|OR">
			<if test="sv != null and sv neq ''.toString()"> 
				AND ${sk} Like CONCAT('%',#{sv},'%')		
			</if>
		</trim>
  	</select>
  	
  	<select	id="getAdminUserUpdate"
 	parameterType="String" 
 	resultType="ksmart.pentagon.vo.User">
		SELECT
 			u.u_number 	AS uNumber 
			,u.u_tel 	AS uTel
			,u.u_id 	AS uId
			,u.u_name 	AS uName
			,u.u_addr	AS uAddr
			,u.u_email 	AS uEmail
			,u.u_overdue_day 	AS uOverdueDay
			,u.u_birth 	AS uBirth
			,u.u_date 	AS uDate
			,ul.ul_name 	AS ulName
			,uas.uas_lend_limit		AS uasLendLimit
			,uas.uas_facility_limit AS uasFacilityLimit
			,uas.uas_name			AS uasName
			,u.u_email_agree 	AS uEmailAgree
		FROM
			user u 
		INNER JOIN 
			user_authority_set as uas
		ON 
			u.uas_code = uas.uas_code
		INNER join
			user_level AS ul
		on
			ul.ul_level = u.ul_level
		WHERE u.u_id = #{uId}
	</select>
	
 	<update id="adminUserUpdate" parameterType="ksmart.pentagon.vo.User">
 		UPDATE user
 		<trim prefix="SET" suffixOverrides=",">
 			<if test="uTel neq null and uTel neq ''.toString()">
 				u_tel=#{uTel},
 			</if>
 			<if test="uAddr neq null and uAddr neq ''.toString()">
 				u_addr=#{uAddr},
 			</if>
 			<if test="uName neq null and uName neq ''.toString()">
 				u_name=#{uName},
 			</if>
 			<if test="uEmail neq null and uEmail neq ''.toString()">
 				u_email=#{uEmail},
 			</if>
 			<if test="uOverdueDay neq null and uOverdueDay neq ''.toString()">
 				u_overdue_day=#{uOverdueDay},
 			</if>
 			<if test="uBirth neq null and uBirth neq ''.toString()">
 				u_birth=#{uBirth},
 			</if>
 			<if test="uEmailAgree neq null and uEmailAgree neq ''.toString()">
 				u_email_agree=#{uEmailAgree},
 			</if>
 			<if test="uasCode neq null and uasCode neq ''.toString()">
 				uas_code=#{uasCode},
 			</if>
 		</trim>
 		WHERE u_id = #{uId}
 	</update>

	<select id="adminUserDetail" resultMap="userResultMap" parameterType="String">
		SELECT 
			u.u_id
			,u.ul_level
			,ul.ul_name
			,u.u_division
			,u.uas_code
			,u.u_number
			,u.u_name
			,u.u_birth
			,u.u_addr
			,u.u_tel
			,u.u_email
			,u.u_email_agree
			,u.u_appointment
			,u.u_overdue_day
			,u.u_date
			,uas.uas_name
			,uas.uas_lend_limit
			,uas.uas_facility_limit
		FROM 
			user u
		INNER JOIN  
			user_authority_set as uas
		ON 
			u.uas_code = uas.uas_code
		INNER join
			user_level AS ul
		on
			ul.ul_level = u.ul_level
		where
			u.u_id=#{uId}
		 
	</select>
	
    <insert id="adUserLevelInsert">
		INSERT INTO user_level(
			 u_id
			 ,l_code
			,ul_level
			,ul_name
			,ul_min
			,ul_max
			,ul_lend_num
			,ul_lend_day
			,ul_date
		)VALUES(
			 #{uId}
			,#{lCode}
			,#{ulLevel}
			,#{ulName}
			,#{ulMin}
			,#{ulMax}
			,#{ulLendNum}
			,#{ulLendDay}
			,#{ulDate}
		)
	</insert>
	
	<insert id="adUserAuthorityInsert">
		INSERT INTO user_authority_set(
			 uas_code
			 ,l_code
			 ,u_id
			,uas_name
			,uas_overdue_min
			,uas_overdue_max
			,uas_lend_limit
			,uas_facility_limit
			,uas_limit_date
			,uas_date
		)VALUES(
			 #{uasCode}
			,#{lCode}
			,#{uId}
			,#{uasName}
			,#{uasOverdueMin}
			,#{uasOverdueMax}
			,#{uasLendLimit}
			,#{uasFacilityLimit}
			,#{uasLimitDate}
			,#{uasDate}
		)
	</insert>
	
	<select id="adUserLevelList" resultMap="userLevel" parameterType="String">
		SELECT 
			*
		FROM 
			user_level
	</select>
	
    <update id="adUserLevelUpdate" parameterType="ksmart.pentagon.vo.UserLevel" >
		UPDATE 
			user_level
		SET
			 ul_level       = #{ulLevel}
			,l_code         = #{lCode}
			,u_id      		= #{uId}
			,ul_name        = #{ulName}
			,ul_min   		= #{ulMin}
			,ul_max         = #{ulMax}
			,ul_lend_num	= #{ulLendNum}
			,ul_lend_day    = #{ulLendDay}
			,ul_date        = #{ulDate}
		WHERE 
			 ul_level = #{ulLevel}
	</update>
	
	<select id="getAdUserLevelUpdate" resultMap="userLevel" parameterType="String">
		SELECT 
			*
		FROM 
			user_level
		where 
			ul_level = #{ulLevel}
	</select>
	
	<select id="adUserAuthorityList" resultMap="userAuthoritySet" parameterType="String">
		SELECT 
			*
		FROM 
			user_authority_set
	</select>
	
	<update id="adUserAuthorityUpdate" parameterType="ksmart.pentagon.vo.UserAuthoritySet" >
		UPDATE 
			user_authority_set
		SET
			 uas_code       	= #{uasCode}
			,l_code        	 	= #{lCode}
			,u_id      			= #{uId}
			,uas_name        	= #{uasName}
			,uas_overdue_min   	= #{uasOverdueMin}
			,uas_overdue_max    = #{uasOverdueMax}
			,uas_lend_limit		= #{uasLendLimit}
			,uas_facility_limit    = #{uasFacilityLimit}
			,uas_limit_date        = #{uasLimitDate}
			,uas_date        	   = #{uasDate}
		WHERE 
			 uas_code = #{uasCode}
	</update>
	
	<select id="getAdUserAuthorityUpdate" resultMap="userAuthoritySet" parameterType="String">
		SELECT 
			*
		FROM 
			user_authority_set
		where 
			uas_code = #{uasCode}
	</select>
	
	
	
	

  </mapper>